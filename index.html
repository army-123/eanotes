<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EA Notes Cloud ‚Äì Login</title>

<style>
:root {
    --bg: #111;
    --card: rgba(255,255,255,0.06);
    --text: #fff;
    --input-bg: rgba(255,255,255,0.12);
    --button: #4a90e2;
    --button-hover: #357abd;
}

/* Light Mode */
.light {
    --bg: #f7f7f7;
    --card: rgba(0,0,0,0.05);
    --text: #111;
    --input-bg: rgba(0,0,0,0.08);
    --button: #333;
    --button-hover: #000;
}

body {
    margin: 0;
    height: 100vh;
    background: var(--bg);
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: "Poppins", sans-serif;
    transition: 0.3s;
}

.card {
    width: 340px;
    padding: 28px;
    border-radius: 16px;
    background: var(--card);
    backdrop-filter: blur(20px);
    box-shadow: 0 0 20px rgba(0,0,0,0.4);
    color: var(--text);
    animation: fadeIn 0.8s ease;
}

.card h2 {
    margin-bottom: 5px;
}

select, input {
    width: 94%;
    padding: 12px;
    margin: 8px 0;
    border-radius: 10px;
    border: none;
    outline: none;
    background: var(--input-bg);
    color: var(--text);
}

button {
    margin-top: 10px;
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: none;
    background: var(--button);
    color: white;
    font-size: 16px;
    cursor: pointer;
}

button:hover {
    background: var(--button-hover);
}

.theme-toggle {
    text-align: center;
    margin-bottom: 10px;
    cursor: pointer;
    font-size: 14px;
    color: var(--text);
    opacity: 0.8;
}

#msg {
    margin-top: 10px;
    color: #ff5555;
    min-height: 20px;
    font-size: 14px;
}

/* Loading Overlay */
#loading {
    position: fixed;
    width: 100%;
    height: 100%;
    display: none;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(6px);
    background: rgba(0,0,0,0.5);
}

.spinner {
    width: 60px;
    height: 60px;
    border: 6px solid rgba(255,255,255,0.3);
    border-top: 6px solid #4a90e2;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
 100% { transform: rotate(360deg); }
}

@keyframes fadeIn {
 from {opacity:0;} to {opacity:1;}
}
</style>
</head>
<body>

<!-- LOADING -->
<div id="loading"><div class="spinner"></div></div>

<div class="card">
    <div class="theme-toggle" onclick="toggleTheme()">üåô / ‚òÄÔ∏è Theme</div>

    <h2>EA Notes Cloud</h2>
    <p>Login to continue</p>

    <select id="role" onchange="switchRole()">
        <option value="student">Student</option>
        <option value="teacher">Teacher</option>
    </select>

    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">

    <button onclick="login()">Login</button>

    <div id="msg"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const supabase = supabase.createClient(
    "https://hlstgluwamsuuqlctdzk.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhsc3RnbHV3YW1zdXVxbGN0ZHprIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyNzMwMzQsImV4cCI6MjA3OTg0OTAzNH0.KUPx3pzrcd3H5aEx2B7mFosWNUVOEzXDD5gL-TmyawQ"
);

const loader = document.getElementById("loading");
const msg = document.getElementById("msg");

function switchRole() {
    const role = document.getElementById("role").value;
    const user = document.getElementById("username");

    if (role === "teacher") {
        user.placeholder = "Email";
    } else {
        user.placeholder = "Student Name";
    }
}

function toggleTheme() {
    document.body.classList.toggle("light");
}

document.addEventListener("keyup", e => {
    if (e.key === "Enter") login();
});

async function login() {
    msg.textContent = "";
    loader.style.display = "flex";

    const role = document.getElementById("role").value;
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!username || !password) {
        loader.style.display = "none";
        msg.textContent = "Please fill all fields.";
        return;
    }

    if (role === "teacher") {
        // TEACHER LOGIN
        const { error } = await supabase.auth.signInWithPassword({
            email: username,
            password: password
        });

        if (error) {
            loader.style.display = "none";
            msg.textContent = error.message;
            return;
        }

        window.location.href = "teacher/teacher.html";
    }

    else {
        // STUDENT LOGIN
        if (password !== "@armyamanu") {
            loader.style.display = "none";
            msg.textContent = "Incorrect student password!";
            return;
        }

        const { data, error } = await supabase
            .from("students")
            .select("*")
            .eq("name", username);

        if (error || data.length === 0) {
            loader.style.display = "none";
            msg.textContent = "Student not found!";
            return;
        }

        window.location.href = "student/student.html";
    }
}
</script>

</body>
</html>
