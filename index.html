<script>
  window.onload = () => {
    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark');
    }
    if (localStorage.getItem('loggedIn') === 'true') {
      showApp();
    }
  };

  function toggleDark() {
    document.body.classList.toggle('dark');
    localStorage.setItem('darkMode', document.body.classList.contains('dark'));
  }

  /* LOGIN SYSTEM */
  function login() {
    const user = document.getElementById("username").value;
    const pass = document.getElementById("password").value;

    if (pass === "@teacher123") {
      localStorage.setItem("role", "teacher");
      localStorage.setItem("loggedIn", "true");
      showApp();
    } 
    else if (pass === "@armyamanu" && user.trim() !== "") {
      localStorage.setItem("role", "student");
      localStorage.setItem("loggedIn", "true");
      showApp();
    } 
    else {
      alert("Incorrect name or password");
    }
  }

  function logout() {
    localStorage.removeItem("loggedIn");
    localStorage.removeItem("role");
    location.reload();
  }

  function showApp() {
    document.getElementById("loginPage").style.display = "none";
    document.getElementById("appPage").style.display = "block";

    const role = localStorage.getItem("role");
    const upload = document.getElementById("fileUpload");

    if (role === "student") {
      upload.style.display = "none";
    } else {
      upload.style.display = "block";
    }

    loadFiles();
  }

  /* FILE SYSTEM */
  function uploadFile() {
    const folder = document.getElementById("folderSelect").value;
    const file = document.getElementById("fileUpload").files[0];
    if (!file) return;

    const reader = new FileReader();

    reader.onload = function(e) {
      const data = {
        name: file.name,
        size: file.size,
        content: e.target.result
      };

      const storageKey = `folder_${folder}`;
      const files = JSON.parse(localStorage.getItem(storageKey) || "[]");
      files.push(data);
      localStorage.setItem(storageKey, JSON.stringify(files));
      loadFiles();
    };

    reader.readAsDataURL(file);
  }

  function loadFiles() {
    const folder = document.getElementById("folderSelect").value;
    const storageKey = `folder_${folder}`;
    const files = JSON.parse(localStorage.getItem(storageKey) || "[]");

    const list = document.getElementById("fileList");
    list.innerHTML = "";

    files.forEach((f, i) => {
      list.innerHTML += `
        <div class='file-item'>
          <b>${f.name}</b><br>
          <small>${(f.size / 1024).toFixed(2)} KB</small><br><br>
          <button disabled style='opacity:0.5; cursor:not-allowed;'>View Only</button>
          <button class='delete-btn' onclick='deleteFile(${i})'>X</button>
        </div>
      `;
    });
  }

  function deleteFile(i) {
    const folder = document.getElementById("folderSelect").value;
    const storageKey = `folder_${folder}`;
    const files = JSON.parse(localStorage.getItem(storageKey) || "[]");
    files.splice(i, 1);
    localStorage.setItem(storageKey, JSON.stringify(files));
    loadFiles();
  }
</script>
